<!DOCTYPE HTML>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>漢字でにゃんこ大戦争</title>
<link rel="apple-touch-icon" href="img/icon.jpg">
<style>
body {
    margin: 0;
    font-family: "Hiragino Maru Gothic ProN", "Yu Gothic", sans-serif;
    background: url('img/kabe.jpg') no-repeat center center fixed;
    background-size: cover;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    overflow-x: hidden;
}
h1 {
    font-size: 2.6em;
    color: #fff;
    text-shadow: 3px 3px #000;
    margin-top: 10px;
}
#groupSelect, #gameScreen, #resultsScreen {
    text-align: center;
    width: 100%;
    max-width: 900px;
    padding: 10px;
}
#groupSelect p, #resultsScreen h2, #question, .result-item p {
    color: #fff;
    text-shadow: 3px 3px #000;
}
.group-button, #nextButton, #restartButton, #clearButton {
    font-size: 1.5em;
    padding: 12px 24px;
    margin: 10px;
    width: auto;
    min-width: 200px;
    border-radius: 15px;
    border: none;
    cursor: pointer;
    transition: transform 0.1s, background 0.2s;
    white-space: nowrap;
}
.group-button:hover, #nextButton:hover, #restartButton:hover, #clearButton:hover {
    transform: translateY(-2px);
}
.group-1 { background-color:#ff9999; }
.group-2 { background-color:#99ff99; }
.group-3 { background-color:#9999ff; }

#clearButton:disabled {
    background-color: #ddd;
    cursor: not-allowed;
    transform: none;
}
@media (max-width: 600px) {
    .group-button, #nextButton, #restartButton, #clearButton {
        width: 80%;
        white-space: normal;
    }
}
#question {
    font-size: 2em;
    font-weight: bold;
    margin: 10px 0;
    min-height: 50px;
    background-color: transparent;
    padding: 8px 12px;
    border-radius: 8px;
}
#drawCanvas {
    border: 2px solid #000;
    display: block;
    margin: 10px auto;
    background-color: #fff;
    touch-action: none;
    width: 90%;
    height: 50vh;
    max-width: 700px;
    border-radius: 10px;
    box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
}
#results {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-auto-rows: auto;
    gap: 5px;
    padding: 10px;
}
.result-item {
    border: 1px solid #ccc;
    border-radius:5px;
    padding:3px;
    background:#fff;
}
.result-item img {
    width: 100%;
}
#nekoTeacher {
    position: fixed;
    bottom: 10px;
    right: 5%;
    width: 120px;
    z-index: 10;
    animation: neko-bounce 2s infinite ease-in-out;
}
@keyframes neko-bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}
@media (orientation: landscape) {
    h1 { font-size: 2.8em; }
    #drawCanvas { height: 45vh; }
    #nekoTeacher { width: 100px; }
}
#animationLayer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    overflow: visible;
    z-index: 50;
}
.character {
    position: absolute;
    width: 60px;
}
</style>
</head>

<body>
<h1>漢字でにゃんこ大戦争</h1>

<div id="groupSelect">
    <p>学習するグループを選ぼう！</p>
    <div id="groupButtons"></div>
</div>

<div id="gameScreen" style="display:none;">
    <div id="question">練習開始！</div>
    <canvas id="drawCanvas"></canvas>
    <div>
        <button id="nextButton">次へ（クリックして開始）</button>
        <button id="clearButton" disabled>消去</button>
    </div>
</div>

<div id="resultsScreen" style="display:none;">
    <h2>結果一覧</h2>
    <div id="results"></div>
    <button id="restartButton">スタートに戻る</button>
</div>

<img src="img/neko.png" id="nekoTeacher" alt="ねこ先生">

<div id="animationLayer"></div>

<script>
const groups = {
"1-1":[["「いち」ねんせい", "一"], ["「みぎ」をむく", "右"], ["「あめ」がふる", "雨"], ["ひゃく「えん」だま", "円"], ["「おう」さま", "王"], ["「おと」がきこえる", "音"], ["「した」をむく", "下"], ["「ひ」あそび", "火"], ["「はな」をうえる", "花"], ["「かい」をひろう", "貝"]],
"1-2":[["さんすうを「まな」ぶ", "学"], ["くう「き」をすう", "気"], ["「きゅう」にん", "九"], ["「やす」む", "休"], ["「たま」がころがる", "玉"], ["「きん」をほる", "金"], ["「そら」があおい", "空"], ["「つき」がでる", "月"], ["「いぬ」がほえる", "犬"], ["テレビを「み」る", "見"]],
"1-3":[["「ご」にん", "五"], ["「くち」をあける", "口"], ["がっ「こう」", "校"], ["「ひだり」をむく", "左"], ["ぼく「さん」さい", "三"], ["「やま」にのぼる", "山"], ["「こ」ども", "子"], ["わたし「よん」さい", "四"], ["「いと」をむすぶ", "糸"], ["「じ」をかく", "字"]],
"1-4":[["「みみ」でおとをきく", "耳"], ["いま「しち」じ", "七"], ["「くるま」にのる", "車"], ["「て」をあらう", "手"], ["「じゅう」じか", "十"], ["「で」かける", "出"], ["おんなのこ", "女"], ["「ちいさ」い", "小"], ["うえをみる", "上"], ["「もり」にいく", "森"]],
"1-5":[["「ひと」があつまる", "人"], ["「みず」をのむ", "水"], ["「ただ」しいこたえ", "正"], ["「い」きる", "生"], ["「あお」いそら", "青"], ["「ゆう」がた", "夕"], ["「いし」をひろう", "石"], ["「あか」いふく", "赤"], ["「せん」えんさつ", "千"], ["「かわ」であそぶ", "川"]],
"1-6":[["「さき」にすすむ", "先"], ["「はや」くおきる", "早"], ["「くさ」がのびる", "草"], ["「あし」をあらう", "足"], ["「むら」にすむ", "村"], ["「おお」きいいぬ", "大"], ["「おとこ」のこ", "男"], ["「たけ」のこ", "竹"], ["「なか」にはいる", "中"], ["「むし」をみつける", "虫"]],
"1-7":[["「まち」をあるく", "町"], ["「てん」きがいい", "天"], ["「た」んぼ", "田"], ["「つち」をさわる", "土"], ["「ふた」つ", "二"], ["「ひ」がのぼる", "日"], ["あなに「はい」る", "入"], ["お「とし」だま", "年"], ["「しろ」いねこ", "白"], ["「はち」ひき", "八"]],
"1-8":[["「ひゃく」えん", "百"], ["「ぶん」をよむ", "文"], ["「き」にのぼる", "木"], ["「ほん」をよむ", "本"], ["「な」まえをかく", "名"], ["「め」をとじる", "目"], ["にほんあしで「た」つ", "立"], ["「ちから」をいれる", "力"], ["「はやし」にいく", "林"], ["「ろく」さい", "六"]],

/* ========== ここから2年生 ========== */
"2-1":[["つな「ひ」き","引"],["せなかに「はね」がある","羽"],["「くも」がうかぶ","雲"],["ひみつのはな「ぞの」","園"],["「とお」くまで","遠"],["「なに」をする？","何"],["かてい「か」","科"],["「なつ」やすみ","夏"],["「いえ」にかえる","家"],["カラオケで「うた」う","歌"]],
"2-2":[["テレビの「が」めん","画"],["こまが「まわ」る","回"],["「あ」いにでかける","会"],["「うみ」でおよぐ","海"],["「え」をえがく","絵"],["「そと」にでる","外"],["「かど」をまがる","角"],["「たの」しい","楽"],["「い」きいきする","活"],["ひととひとの「あいだ」","間"]],
"2-3":[["「まる」いもの","丸"],["「いわ」がある","岩"],["「かお」をみる","顔"],["「き」しゃにのる","汽"],["にっ「き」にかく","記"],["「かえ」りみち","帰"],["「ゆみ」をひく","弓"],["ぼくじょうの「うし」","牛"],["きょうのごはんは「さかな」","魚"],["「きょう」とに行く","京"],["「つよ」いこころ","強"]],
"2-4":[["せんせいが「おし」える","教"],["きょりが「ちか」い","近"],["「あに」についていく","兄"],["ものの「かたち」","形"],["「けい」さんする","計"],["ぼくは「げん」き","元"],["もんくを「い」う","言"],["の「はら」ひろし","原"],["「と」じまりをする","戸"],["「ふる」いとけい","古"]],
"2-5":[["「ご」ぜんちゅう","午"],["「うしろ」にならぶ","後"],["こく「ご」がにがて","語"],["どうろ「こう」じ","工"],["「こう」園に行く","公"],["「ひろ」いへや","広"],["「まじ」わる","交"],["ひかり","光"],["かんがえる","考"],["いく","行"]],
"2-6":[["たかい","高"],["きいろ","黄"],["あわせる","合"],["たに","谷"],["くに","国"],["くろい","黒"],["いま","今"],["「さい」のうがある","才"],["「ほそ」いえだ","細"],["おりがみを「つく」る","作"]],
"2-7":[["「さん」すう","算"],["「と」まる","止"],["まつやま「し」","市"],["「や」をうつ","矢"],["「あね」をてつだう","姉"],["ぼくも「おも」う","思"],["テストの「かみ」","紙"],["「てら」に行く","寺"],["「じ」ぶんのつくえ","自"],["「と」けいを見る","時"]],
"2-8":[["きょう「しつ」","室"],["かい「しゃ」にいく","社"],["「よわ」い","弱"],["「くび」が長い","首"],["しょくよくの「あき」","秋"],["いっ「しゅう」かん","週"],["「はる」がきた","春"],["じを「か」く","書"],["「すくな」い","少"],["「ば」しょをかえよう","場"]],
"2-9":[["クレヨンの「いろ」","色"],["バナナを「た」べる","食"],["「こころ」がいたむ","心"],["「あたら」しいカギ","新"],["さんかんびに「おや」がきた","親"],["「ず」をかく","図"],["「かず」をかぞえる","数"],["「にし」にむかう","西"],["「こえ」がきこえる","声"],["よぞらの「ほし」","星"]],
"2-10":[["てんきが「は」れる","晴"],["さかなを「き」る","切"],["「ゆき」がふる","雪"],["「ふね」にのる","船"],["てんをむすぶと「せん」になる","線"],["「まえ」を見て","前"],["うでを「く」む","組"],["ぜんりょくで「はし」る","走"],["ミスが「おお」い","多"],["えだが「ふと」いきだ","太"]],
"2-11":[["「からだ」がおおきい","体"],["「だい」どころ","台"],["デパートの「ち」か","地"],["「いけ」をおよぐこい","池"],["じじつを「し」る","知"],["お「ちゃ」がうまい","茶"],["「ひる」ごはんがたのしみ","昼"],["「なが」いものにまかれろ","長"],["「とり」がとんでいる","鳥"],["あたらしい「あさ」がきた","朝"]],
"2-12":[["しせいを「なお」す","直"],["あのみちを「とお」る","通"],["かわいい「おとうと」","弟"],["お「みせ」やさん","店"],["「てん」をうつ","点"],["「でん」わをかける","電"],["きれあじがよい「かたな」","刀"],["「ふゆ」はさむい","冬"],["くじが「あ」たる","当"],["「ひがし」にむかう","東"]],
"2-13":[["すぐに「こた」える","答"],["「あたま」がいたい","頭"],["じんるいみな「おな」じ","同"],["たんぼ「みち」","道"],["ほんを「よ」む","読"],["「うち」にひめたおもい","内"],["「みなみ」のほうがく","南"],["さかなより「にく」","肉"],["「うま」にのる","馬"]],
"2-14":[["こめを「う」る","売"],["ネットで「か」う","買"],["「むぎ」ばたけ","麦"],["「はん」ぶんこ","半"],["きみの「ばん」だ","番"],["「ちち」とはは","父"],["「かぜ」がきもちいい","風"],["ふたつに「わ」ける","分"],["こえを「き」く","聞"]],
"2-15":[["ちゃわんにはいった「こめ」","米"],["「ある」く","歩"],["「はは」はつよし","母"],["みなみの「ほう」こう","方"],["「きた」のほうがく","北"],["「まい」にちがっこうへいく","毎"],["あねと「いもうと」","妹"],["いち「まん」えん","万"],["「あか」るい","明"],["いぬが「な」く","鳴"],["ねこの「け」","毛"]],
"2-16":[["「もん」がひらく","門"],["「よる」はこわい","夜"],["「の」はらしんのすけ","野"],["「とも」だち","友"],["「もち」いる","用"],["にち「よう」び","曜"],["せんせいが「く」る","来"],["ふる「さと」","里"],["「り」かがとくいだ","理"],["ともだちと「はな」す","話"]],

/* ========== ここから3年生 ========== */
"3-1":[["「わる」いたくらみ","悪"],["「やす」らかに","安"],["「くら」いよる","暗"],["「い」しゃにみてもらう","医"],["「い」いんかい","委"],["ことばの「い」み","意"],["「そだ」てる","育"],["い「いん」かいのひと","員"],["びょう「いん」に行く","院"],["くすりを「の」む","飲"]],
"3-2":[["「うん」どうかい","運"],["プールで「およ」ぐ","泳"],["「えき」いんさん","駅"],["ちゅう「おう」のぞう","央"],["「よこ」がお","横"],["ラーメン「や」","屋"],["おふろの「おん」ど","温"],["お「ば」けが出る","化"],["「に」もつをはこぶ","荷"],["きょう「かい」線","界"]],
"3-3":[["とびらを「ひら」く","開"],["「かい」だんをのぼる","階"],["冬は「さむ」い","寒"],["いたみを「かん」じる","感"],["「かん」字はにがてだ","漢"],["としょ「かん」","館"],["「きし」まで泳ぐ","岸"],["あさ「お」きる","起"],["「き」たいする","期"],["お「きゃく」さま","客"]],
"3-4":[["けん「きゅう」しゃ","究"],["「きゅう」なようじ","急"],["がっ「きゅう」いいん","級"],["「みや」ぎけん","宮"],["や「きゅう」をする","球"],["「さる」者をおわず","去"],["川にかかる「はし」","橋"],["あなたのしょく「ぎょう」は","業"],["「ま」がり角","曲"],["テレビ「きょく」","局"]],
"3-5":[["「ぎん」こう","銀"],["リレーの「く」かん","区"],["「にが」いおちゃ","苦"],["「ぐ」だくさん","具"],["「きみ」の名は？","君"],["きゅうしょく「がかり」","係"],["「かる」いにもつ","軽"],["けがをして「ち」が出た","血"],["「けっ」しょうせん","決"],["「けん」きゅうじょ","研"]],
"3-6":[["えひめ「けん」","県"],["そう「こ」","庫"],["みずうみ","湖"],["後ろを「む」く","向"],["わたしは「しあわ」せ","幸"],["「みなと」にふねが","港"],["4「ごう」車","号"],["木の「ね」","根"],["「まつり」だわっしょい","祭"],["「さら」をわる","皿"]],
"3-7":[["「し」ごとに行く","仕"],["「し」ぬのはこわい","死"],["どうぐを「つか」う","使"],["べんきょうを「はじ」める","始"],["この「ゆび」とまれ","指"],["「は」いしゃに行く","歯"],["「し」人のたてごと","詩"],["「つぎ」の回","次"],["「じ」けんはっせい","事"],["どうぐを「も」つ","持"]],
"3-8":[["けっこん「しき」","式"],["きの「み」ひろい","実"],["「しゃ」しんをとる","写"],["あやしい「もの」がいる","者"],["話の「しゅ」じんこう","主"],["「まも」る","守"],["石を「と」る","取"],["「さけ」をのむ","酒"],["テストを「う」ける","受"],["きゅう「しゅう」のじいじ","州"]],
"3-9":[["おとしものを「ひろ」う","拾"],["テストが「おわ」る","終"],["やきゅうを「なら」う","習"],["みな「あつ」まれ","集"],["家に「す」む","住"],["「おも」い石","重"],["「やど」につく","宿"],["家の場「しょ」","所"],["夏は「あつ」い","暑"],["「たす」ける","助"]],
"3-10":[["「しょう」わてんのう","昭"],["「き」える","消"],["「しょう」ばいにん","商"],["だい１「しょう」","章"],["「しょう」りをつかむ","勝"],["車に「の」る","乗"],["木を「う」える","植"],["ものを「もう」す","申"],["「しん」ちょう","身"],["「かみ」さま","神"]],
"3-11":[
["「しん」じる心","真"],
["「ふか」い海","深"],
["前に「すす」む","進"],
["「せ」かいの国々","世"],
["つくえを「ととの」える","整"],
["「むかし」ばなし","昔"],
["「ぜん」いん出席","全"],
["「あい」手の話を聞く","相"],
["手紙を「おく」る","送"],
["「そう」ぞうする","想"]
],

"3-12":[
["「いき」が続く","息"],
["車の「そく」ど","速"],
["家「ぞく」で出かける","族"],
["「ほか」の人","他"],
["ボールを「う」つ","打"],
["「たい」話をする","対"],
["バスを「ま」つ","待"],
["「か」わりに行く","代"],
["「だい」二の門","第"],
["問「だい」をとく","題"]
],

"3-13":[
["木をもやして「すみ」をつくる","炭"],
["時間が「みじか」い","短"],
["先生に相「だん」する","談"],
["ふくを「き」る","着"],
["水を「そそ」ぐ","注"],
["木の「はしら」","柱"],
["とうふいっ「ちょう」","丁"],
["ノートの「ちょう」めん","帳"],
["じけんを「しら」べる","調"],
["あとを「お」う","追"]
],

"3-14":[
["きまりを「さだ」める","定"],
["「にわ」であそぶ","庭"],
["「ふえ」をふく","笛"],
["「てつ」どう","鉄"],
["玉が「ころ」がる","転"],
["「みやこ」に行く","都"],
["一「ど」だけ見る","度"],
["ボールを「な」げる","投"],
["「まめ」を食べる","豆"],
["「しま」にすむ","島"]
],

"3-15":[
["「ゆ」ぶねにつかる","湯"],
["山に「のぼ」る","登"],
["「ひと」しい重さ","等"],
["からだを「うご」かす","動"],
["イソップ「どう」話","童"],
["「のう」かの人","農"],
["「なみ」が高い","波"],
["手紙を「くば」る","配"],
["二「ばい」にする","倍"],
["「はこ」に入れる","箱"]
],

"3-16":[
["「はたけ」でやさいを作る","畑"],
["じけんが「はっ」生する","発"],
["「はん」たいのいけん","反"],
["「さか」をのぼる","坂"],
["木の「いた」をけずる","板"],
["羊のけ「がわ」","皮"],
["「かな」しい出来事","悲"],
["「うつく」しい花","美"],
["「はな」みずが出る","鼻"],
["「ふで」をつかう","筆"]
],

"3-17":[
["「こおり」がとける","氷"],
["「おもて」を見る","表"],
["「びょう」しんをはかる","秒"],
["「びょう」いんに行く","病"],
["お「しな」ものをならべる","品"],
["「ま」けずぎらい","負"],
["「ぶ」かつに入る","部"],
["「ふく」をたたむ","服"],
["こう「ふく」な人生","福"],
["「もの」がたり","物"]
],

"3-18":[
["「たい」らな道","平"],
["ボールを「かえ」す","返"],
["「べん」きょうをする","勉"],
["馬を「はな」す","放"],
["おいしい「あじ」","味"],
["「いのち」のたんじょう","命"],
["さんかくけいの「めん」せき","面"],
["「もん」だいをとく","問"],
["「やく」にたつ","役"],
["「くすり」をのむ","薬"]
],

"3-19":[
["けんかのり「ゆう」","由"],
["「あぶら」を売る","油"],
["おかねが「あ」る","有"],
["こうえんで「あそ」ぶ","遊"],
["「よ」ていを立てる","予"],
["「ひつじ」のえをかく","羊"],
["たいへい「よう」","洋"],
["「は」っぱをひろう","葉"],
["たい「よう」が出る","陽"],
["「さま」ざまな色","様"]
],

"3-20":[
["花が「お」ちる","落"],
["水が「なが」れる","流"],
["「たび」に出る","旅"],
["「りょう」手で持つ","両"],
["「みどり」の草","緑"],
["「れい」を言う","礼"],
["「れつ」にならぶ","列"],
["「れん」しゅうする","練"],
["どう「ろ」を歩く","路"],
["「わ」食がすきだ","和"]
]
};

let currentGroup = [];
let questionHistory = [];
let savedDrawings = [];
let i = 0, t = 0;
let drawingEnabled = true;
let isDrawing = false;

const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
ctx.lineWidth = 5;
ctx.strokeStyle = '#000';

function getPoint(e) {
    const rect = canvas.getBoundingClientRect();
    let clientX, clientY;
    if (e.touches && e.touches.length > 0) {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
    } else {
        clientX = e.clientX;
        clientY = e.clientY;
    }
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
}
function startDrawing(e){ if(!drawingEnabled)return; e.preventDefault(); isDrawing=true; const {x,y}=getPoint(e); ctx.beginPath(); ctx.moveTo(x,y);}
function draw(e){ if(!isDrawing||!drawingEnabled)return; e.preventDefault(); const {x,y}=getPoint(e); ctx.lineTo(x,y); ctx.stroke();}
function stopDrawing(){ isDrawing=false; ctx.closePath();}
function clearCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height);}
function saveCanvasImage(){
    const tempCanvas = document.createElement('canvas');
    tempCanvas.width = canvas.width;
    tempCanvas.height = canvas.height;
    const tempCtx = tempCanvas.getContext('2d');
    tempCtx.fillStyle = '#fff';
    tempCtx.fillRect(0,0,tempCanvas.width,tempCanvas.height);
    tempCtx.drawImage(canvas,0,0);
    return tempCanvas.toDataURL();
}

canvas.addEventListener('mousedown',startDrawing);
canvas.addEventListener('mousemove',draw);
canvas.addEventListener('mouseup',stopDrawing);
canvas.addEventListener('mouseleave',stopDrawing);
canvas.addEventListener('touchstart',startDrawing);
canvas.addEventListener('touchmove',draw);
canvas.addEventListener('touchend',stopDrawing);

function startGroup(key){
    currentGroup = shuffle([...groups[key]]);
    i=0; t=0;
    questionHistory=[]; savedDrawings=[];
    drawingEnabled=true;
    clearCanvas();
    document.getElementById('groupSelect').style.display='none';
    document.getElementById('resultsScreen').style.display='none';
    document.getElementById('gameScreen').style.display='block';
    document.getElementById('nextButton').textContent="次へ（クリックして開始）";
    document.getElementById('nextButton').onclick = change;
    document.getElementById('clearButton').disabled = true;
    document.getElementById('question').textContent="練習開始！";
}

function change(){
    const Q=document.getElementById('question');
    const clearBtn=document.getElementById('clearButton');

    if(i>=10 && t===0){
        Q.textContent="全問終了！結果を確認してね。";
        document.getElementById('nextButton').textContent="結果を見る";
        document.getElementById('nextButton').onclick=endGame;
        clearBtn.disabled=true;
        return;
    }

    if(t===0){
        if(i>0)savedDrawings.push(saveCanvasImage());
        clearCanvas(); drawingEnabled=true;
        const [q,a]=currentGroup[i];
        Q.textContent=`問${i+1}: ${q}`;
        questionHistory.push({question:q,answer:a});
        document.getElementById('nextButton').textContent="解答へ";
        clearBtn.disabled=false;
        t=1;

        if(Math.random()<0.5){ showRandomCharacter(); }

    } else {
        drawingEnabled=false;
        Q.textContent=`問${i+1}: ${currentGroup[i][1]}`;
        document.getElementById('nextButton').textContent=(i<9)?"次の問題へ":"結果を見る";
        clearBtn.disabled=true;
        t=0; i++;
    }
}

function endGame(){
    savedDrawings.push(saveCanvasImage());
    document.getElementById('gameScreen').style.display='none';
    document.getElementById('resultsScreen').style.display='block';
    const results=document.getElementById('results');
    results.innerHTML='';
    questionHistory.forEach((h,idx)=>{
        const div=document.createElement('div');
        div.className='result-item';
        div.innerHTML=`<p><strong>問${idx+1}:</strong> ${h.question} → <strong>${h.answer}</strong></p>`;
        const img=document.createElement('img');
        img.src=savedDrawings[idx];
        div.appendChild(img);
        results.appendChild(div);
    });
}
document.getElementById('restartButton').onclick=()=>{
    i=0;t=0;questionHistory=[];savedDrawings=[];
    document.getElementById('resultsScreen').style.display='none';
    document.getElementById('groupSelect').style.display='block';
    clearCanvas();
};

document.getElementById('clearButton').onclick=()=>{ if(!drawingEnabled)return; clearCanvas(); };

function shuffle(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]]; } return array; }
const btnArea=document.getElementById('groupButtons');
Object.keys(groups).forEach(k=>{
    const btn=document.createElement('button');
    btn.textContent=k;
    btn.className='group-button group-'+k.charAt(0);
    btn.onclick=()=>startGroup(k);
    btnArea.appendChild(btn);
});

function showRandomCharacter(){
    const chars=["neko1.png","neko2.png","neko3.png","neko4.png"];
    const img = document.createElement('img');
    img.src="img/"+chars[Math.floor(Math.random()*chars.length)];
    img.className="character";
    const layer = document.getElementById('animationLayer');
    layer.appendChild(img);

    let x = Math.random() * (window.innerWidth - 60);
    let y = Math.random() * (window.innerHeight - 60);
    let dx = (Math.random()-0.5)*4;
    let dy = (Math.random()-0.5)*4;
    let rotation = 0;
    let dRotation = (Math.random()-0.5)*0.2;

    function animate(){
        x += dx;
        y += dy;
        rotation += dRotation;
        img.style.transform = `translate(${x}px, ${y}px) rotate(${rotation}rad)`;
        if(x<-100 || x>window.innerWidth+100 || y<-100 || y>window.innerHeight+100){
            img.remove();
            return;
        }
        requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
}
</script>
</body>
</html>
</html>

