<!DOCTYPE HTML>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>漢字でにゃんこ大戦争</title>
<link rel="apple-touch-icon" sizes="180x180" href="icon.png">
<style>
body {
    margin: 0;
    font-family: "Hiragino Maru Gothic ProN", "Yu Gothic", sans-serif;
    background: url("img/kabe.jpg") repeat fixed; /* ✅ 背景を固定＆繰り返し表示 */
    background-size: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
}
h1 {
    font-size: 2.6em;
    color: #fff;
    text-shadow: 3px 3px #000;
    margin-top: 10px;
}
#groupSelect, #gameScreen, #resultsScreen {
    text-align: center;
    width: 100%;
    max-width: 900px;
    padding: 10px;
}
.group-button, #nextButton, #restartButton, #clearButton {
    font-size: 1.5em;
    padding: 12px 24px;
    margin: 10px;
    width: auto;
    min-width: 250px;
    border-radius: 15px;
    border: none;
    background-color: #fff799;
    cursor: pointer;
    transition: transform 0.1s, background 0.2s;
    white-space: nowrap;
}
.group-button:hover, #nextButton:hover, #restartButton:hover, #clearButton:hover {
    background-color: #ffe66d;
    transform: translateY(-2px);
}
@media (max-width: 600px) {
    .group-button, #nextButton, #restartButton, #clearButton {
        width: 80%;
        white-space: normal;
    }
}
#question {
    font-size: 2em;
    font-weight: bold;
    color: #333;
    margin: 10px 0;
    min-height: 50px;
}
#drawCanvas {
    border: 2px solid #000;
    display: block;
    margin: 10px auto;
    background-color: #fff;
    touch-action: none;
    width: 90%;
    height: 50vh;
    max-width: 700px;
    border-radius: 10px;
    box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
}
#results {
    text-align: left;
    padding: 10px;
    font-size: 1.2em;
}
.result-item {
    margin-bottom: 20px;
    border-bottom: 1px solid #ccc;
    padding-bottom: 10px;
}
#nekoTeacher {
    position: fixed;
    bottom: 10px;
    right: 5%;
    width: 120px;
    z-index: 10;
    animation: neko-bounce 2s infinite ease-in-out;
}
@keyframes neko-bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}
@media (orientation: landscape) {
    h1 { font-size: 2.8em; }
    #drawCanvas { height: 45vh; }
    #nekoTeacher { width: 100px; }
}
</style>
</head>

<body>
<h1>漢字でにゃんこ大戦争</h1>

<!-- タイトル画面 -->
<div id="groupSelect">
    <p>学習するグループを選ぼう！</p>
    <div id="groupButtons"></div>
</div>

<!-- ゲーム画面 -->
<div id="gameScreen" style="display:none;">
    <!-- ✅ top.jpgは削除 -->
    <div id="question">練習開始！</div>
    <canvas id="drawCanvas"></canvas>
    <div>
        <button id="nextButton">次へ（クリックして開始）</button>
        <button id="clearButton" style="display:none;">消去</button>
    </div>
</div>

<!-- 結果画面 -->
<div id="resultsScreen" style="display:none;">
    <h2>結果一覧</h2>
    <div id="results"></div>
    <button id="restartButton">スタートに戻る</button>
</div>

<!-- にゃんこ先生 -->
<img src="img/neko.png" id="nekoTeacher" alt="ねこ先生">

<script>
/*============ グループデータ ============*/
const kanjiList = [
"一","右","雨","円","王","音","下","火","花","貝",
"学","気","九","休","玉","金","空","月","犬","見",
"五","口","校","左","三","山","子","四","糸","字",
"耳","七","車","手","十","出","女","小","上","森",
"人","水","正","生","青","夕","石","赤","千","川",
"先","早","草","足","村","大","男","竹","中","虫",
"町","天","田","土","二","日","入","年","白","八",
"百","文","木","本","名","目","立","力","林","六"
];
const groups = {};
for (let g = 0; g < 8; g++) {
    groups[`1-${g+1}`] = [];
    for (let j = 0; j < 10; j++) {
        const index = g*10 + j;
        groups[`1-${g+1}`].push([`「${kanjiList[index]}」をかこう`, kanjiList[index]]);
    }
}

/*============ 状態管理 ============*/
let currentGroup = [];
let questionHistory = [];
let savedDrawings = [];
let i = 0, t = 0;
let drawingEnabled = true;
let isDrawing = false;

/*============ キャンバス描画 ============*/
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
ctx.lineWidth = 5;
ctx.strokeStyle = '#000';

function getPoint(e) {
    const rect = canvas.getBoundingClientRect();
    let clientX, clientY;
    if (e.touches && e.touches.length > 0) {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
    } else {
        clientX = e.clientX;
        clientY = e.clientY;
    }
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
}
function startDrawing(e){ if(!drawingEnabled)return; e.preventDefault(); isDrawing=true; const {x,y}=getPoint(e); ctx.beginPath(); ctx.moveTo(x,y);}
function draw(e){ if(!isDrawing||!drawingEnabled)return; e.preventDefault(); const {x,y}=getPoint(e); ctx.lineTo(x,y); ctx.stroke();}
function stopDrawing(){ isDrawing=false; ctx.closePath();}
function clearCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height);}
function saveCanvasImage(){ return canvas.toDataURL(); }

canvas.addEventListener('mousedown',startDrawing);
canvas.addEventListener('mousemove',draw);
canvas.addEventListener('mouseup',stopDrawing);
canvas.addEventListener('mouseleave',stopDrawing);
canvas.addEventListener('touchstart',startDrawing);
canvas.addEventListener('touchmove',draw);
canvas.addEventListener('touchend',stopDrawing);

/*============ ゲーム制御 ============*/
function startGroup(key){
    currentGroup = shuffle([...groups[key]]);
    i=0; t=0;
    questionHistory=[]; savedDrawings=[];
    drawingEnabled=true;
    clearCanvas();
    document.getElementById('groupSelect').style.display='none';
    document.getElementById('resultsScreen').style.display='none';
    document.getElementById('gameScreen').style.display='block';
    document.getElementById('nextButton').textContent="次へ（クリックして開始）";
    document.getElementById('nextButton').onclick = change;
    document.getElementById('clearButton').style.display='none';
    document.getElementById('question').textContent="練習開始！";
}
function change(){
    const Q=document.getElementById('question');
    const clearBtn=document.getElementById('clearButton');
    if(i>=10 && t===0){
        Q.textContent="全問終了！結果を確認してね。";
        document.getElementById('nextButton').textContent="結果を見る";
        document.getElementById('nextButton').onclick=endGame;
        clearBtn.style.display='none';
        return;
    }
    if(t===0){
        if(i>0)savedDrawings.push(saveCanvasImage());
        clearCanvas(); drawingEnabled=true;
        const [q,a]=currentGroup[i];
        Q.textContent=`問${i+1}: ${q}`;
        questionHistory.push({question:q,answer:a});
        document.getElementById('nextButton').textContent="解答へ";
        clearBtn.style.display='inline-block';
        clearBtn.onclick = ()=>{ if(drawingEnabled) clearCanvas(); };
        t=1;
    } else {
        drawingEnabled=false;
        Q.textContent=`問${i+1}: ${currentGroup[i][1]}`;
        document.getElementById('nextButton').textContent=(i<9)?"次の問題へ":"結果を見る";
        clearBtn.style.display='none';
        t=0; i++;
    }
}
function endGame(){
    savedDrawings.push(saveCanvasImage());
    document.getElementById('gameScreen').style.display='none';
    document.getElementById('resultsScreen').style.display='block';
    const results=document.getElementById('results');
    results.innerHTML='';
    questionHistory.forEach((h,idx)=>{
        const div=document.createElement('div');
        div.className='result-item';
        div.innerHTML=`<p><strong>問${idx+1}:</strong> ${h.question} → <strong>${h.answer}</strong></p>`;
        const img=document.createElement('img');
        img.src=savedDrawings[idx];
        img.style.width='100%';
        img.style.border='1px solid #ddd';
        div.appendChild(img);
        results.appendChild(div);
    });
}
document.getElementById('restartButton').onclick=()=>{
    i=0;t=0;questionHistory=[];savedDrawings=[];
    document.getElementById('resultsScreen').style.display='none';
    document.getElementById('groupSelect').style.display='block';
    clearCanvas();
};

/*============ ユーティリティ ============*/
function shuffle(array){
    for(let i=array.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
    }
    return array;
}

/*============ グループボタン生成 ============*/
const btnArea=document.getElementById('groupButtons');
Object.keys(groups).forEach(k=>{
    const btn=document.createElement('button');
    btn.textContent=k;
    btn.className='group-button';
    btn.onclick=()=>startGroup(k);
    btnArea.appendChild(btn);
});
</script>
</body>
</html>
