<!DOCTYPE HTML>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>漢字でにゃんこ大戦争</title>
<link rel="apple-touch-icon" href="img/icon.jpg">
<style>
body {
    margin: 0;
    font-family: "Hiragino Maru Gothic ProN", "Yu Gothic", sans-serif;
    background: url('img/kabe.jpg') no-repeat center center fixed;
    background-size: cover;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    overflow-x: hidden;
}
h1 {
    font-size: 2.6em;
    color: #fff;
    text-shadow: 3px 3px #000;
    margin-top: 10px;
}
#groupSelect, #gameScreen, #resultsScreen {
    text-align: center;
    width: 100%;
    max-width: 900px;
    padding: 10px;
}
#groupSelect p, #resultsScreen h2, #question, .result-item p {
    color: #fff;
    text-shadow: 3px 3px #000;
}
.group-button, #nextButton, #restartButton, #clearButton {
    font-size: 1.5em;
    padding: 12px 24px;
    margin: 10px;
    width: auto;
    min-width: 200px;
    border-radius: 15px;
    border: none;
    cursor: pointer;
    transition: transform 0.1s, background 0.2s;
    white-space: nowrap;
}
.group-button:hover, #nextButton:hover, #restartButton:hover, #clearButton:hover {
    transform: translateY(-2px);
}
.group-1 { background-color:#ff9999; }
.group-2 { background-color:#99ff99; }
.group-3 { background-color:#9999ff; }

#clearButton:disabled {
    background-color: #ddd;
    cursor: not-allowed;
    transform: none;
}
@media (max-width: 600px) {
    .group-button, #nextButton, #restartButton, #clearButton {
        width: 80%;
        white-space: normal;
    }
}
#question {
    font-size: 2em;
    font-weight: bold;
    margin: 10px 0;
    min-height: 50px;
    background-color: transparent;
    padding: 8px 12px;
    border-radius: 8px;
}
#drawCanvas {
    border: 2px solid #000;
    display: block;
    margin: 10px auto;
    background-color: #fff;
    touch-action: none;
    width: 90%;
    height: 50vh;
    max-width: 700px;
    border-radius: 10px;
    box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
}
#results {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-auto-rows: auto;
    gap: 5px;
    padding: 10px;
}
.result-item {
    border: 1px solid #ccc;
    border-radius:5px;
    padding:3px;
    background:#fff;
}
.result-item img {
    width: 100%;
}
#nekoTeacher {
    position: fixed;
    bottom: 10px;
    right: 5%;
    width: 120px;
    z-index: 10;
    animation: neko-bounce 2s infinite ease-in-out;
}
@keyframes neko-bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}
@media (orientation: landscape) {
    h1 { font-size: 2.8em; }
    #drawCanvas { height: 45vh; }
    #nekoTeacher { width: 100px; }
}
#animationLayer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    overflow: visible;
    z-index: 50;
}
.character {
    position: absolute;
    width: 60px;
}
</style>
</head>

<body>
<h1>漢字でにゃんこ大戦争</h1>

<div id="groupSelect">
    <p>学習するグループを選ぼう！</p>
    <div id="groupButtons"></div>
</div>

<div id="gameScreen" style="display:none;">
    <div id="question">練習開始！</div>
    <canvas id="drawCanvas"></canvas>
    <div>
        <button id="nextButton">次へ（クリックして開始）</button>
        <button id="clearButton" disabled>消去</button>
    </div>
</div>

<div id="resultsScreen" style="display:none;">
    <h2>結果一覧</h2>
    <div id="results"></div>
    <button id="restartButton">スタートに戻る</button>
</div>

<img src="img/neko.png" id="nekoTeacher" alt="ねこ先生">

<div id="animationLayer"></div>

<script>
const groups = {
"1-1":[["「いち」ねんせい", "一"], ["「みぎ」をむく", "右"], ["「あめ」がふる", "雨"], ["ひゃく「えん」だま", "円"], ["「おう」さま", "王"], ["「おと」がきこえる", "音"], ["「した」をむく", "下"], ["「ひ」あそび", "火"], ["「はな」をうえる", "花"], ["「かい」をひろう", "貝"]],
"1-2":[["さんすうを「まな」ぶ", "学"], ["くう「き」をすう", "気"], ["「きゅう」にん", "九"], ["「やす」む", "休"], ["「たま」がころがる", "玉"], ["「きん」をほる", "金"], ["「そら」があおい", "空"], ["「つき」がでる", "月"], ["「いぬ」がほえる", "犬"], ["テレビを「み」る", "見"]],
"1-3":[["「ご」にん", "五"], ["「くち」をあける", "口"], ["がっ「こう」", "校"], ["「ひだり」をむく", "左"], ["ぼく「さん」さい", "三"], ["「やま」にのぼる", "山"], ["「こ」ども", "子"], ["わたし「よん」さい", "四"], ["「いと」をむすぶ", "糸"], ["「じ」をかく", "字"]],
"1-4":[["「みみ」でおとをきく", "耳"], ["いま「しち」じ", "七"], ["「くるま」にのる", "車"], ["「て」をあらう", "手"], ["「じゅう」じか", "十"], ["「で」かける", "出"], ["おんなのこ", "女"], ["「ちいさ」い", "小"], ["うえをみる", "上"], ["「もり」にいく", "森"]],
"1-5":[["「ひと」があつまる", "人"], ["「みず」をのむ", "水"], ["「ただ」しいこたえ", "正"], ["「い」きる", "生"], ["「あお」いそら", "青"], ["「ゆう」がた", "夕"], ["「いし」をひろう", "石"], ["「あか」いふく", "赤"], ["「せん」えんさつ", "千"], ["「かわ」であそぶ", "川"]],
"1-6":[["「さき」にすすむ", "先"], ["「はや」くおきる", "早"], ["「くさ」がのびる", "草"], ["「あし」をあらう", "足"], ["「むら」にすむ", "村"], ["「おお」きいいぬ", "大"], ["「おとこ」のこ", "男"], ["「たけ」のこ", "竹"], ["「なか」にはいる", "中"], ["「むし」をみつける", "虫"]],
"1-7":[["「まち」をあるく", "町"], ["「てん」きがいい", "天"], ["「た」んぼ", "田"], ["「つち」をさわる", "土"], ["「ふた」つ", "二"], ["「ひ」がのぼる", "日"], ["あなに「はい」る", "入"], ["お「とし」だま", "年"], ["「しろ」いねこ", "白"], ["「はち」ひき", "八"]],
"1-8":[["「ひゃく」えん", "百"], ["「ぶん」をよむ", "文"], ["「き」にのぼる", "木"], ["「ほん」をよむ", "本"], ["「な」まえをかく", "名"], ["「め」をとじる", "目"], ["にほんあしで「た」つ", "立"], ["「ちから」をいれる", "力"], ["「はやし」にいく", "林"], ["「ろく」さい", "六"]],

/* ========== ここから2年生 ========== */
"2-1":[["つな「ひ」き","引"],["せなかに「はね」がある","羽"],["「くも」がうかぶ","雲"],["ひみつのはな「ぞの」","園"],["「とお」くまで","遠"],["「なに」をする？","何"],["かてい「か」","科"],["「なつ」やすみ","夏"],["「いえ」にかえる","家"],["カラオケで「うた」う","歌"]],
"2-2":[["テレビの「が」めん","画"],["こまが「まわ」る","回"],["「あ」いにでかける","会"],["「うみ」でおよぐ","海"],["「え」をえがく","絵"],["「そと」にでる","外"],["「かど」をまがる","角"],["「たの」しい","楽"],["「い」きいきする","活"],["ひととひとの「あいだ」","間"]],
"2-3":[["「まる」いもの","丸"],["「いわ」がある","岩"],["「かお」をみる","顔"],["「き」しゃにのる","汽"],["にっ「き」にかく","記"],["「かえ」りみち","帰"],["「ゆみ」をひく","弓"],["ぼくじょうの「うし」","牛"],["きょうのごはんは「さかな」","魚"],["「きょう」とに行く","京"],["「つよ」いこころ","強"]],
"2-4":[["せんせいが「おし」える","教"],["きょりが「ちか」い","近"],["「あに」についていく","兄"],["ものの「かたち」","形"],["「けい」さんする","計"],["ぼくは「げん」き","元"],["もんくを「い」う","言"],["の「はら」ひろし","原"],["「と」じまりをする","戸"],["「ふる」いとけい","古"]],
"2-5":[["「ご」ぜんちゅう","午"],["「うしろ」にならぶ","後"],["こく「ご」がにがて","語"],["どうろ「こう」じ","工"],["「こう」園に行く","公"],["「ひろ」いへや","広"],["「まじ」わる","交"],["ひかり","光"],["かんがえる","考"],["いく","行"]],
"2-6":[["たかい","高"],["きいろ","黄"],["あわせる","合"],["たに","谷"],["くに","国"],["くろい","黒"],["いま","今"],["「さい」のうがある","才"],["「ほそ」いえだ","細"],["おりがみを「つく」る","作"]],
"2-7":[["「さん」すう","算"],["「と」まる","止"],["まつやま「し」","市"],["「や」をうつ","矢"],["「あね」をてつだう","姉"],["ぼくも「おも」う","思"],["テストの「かみ」","紙"],["「てら」に行く","寺"],["「じ」ぶんのつくえ","自"],["「と」けいを見る","時"]],
"2-8":[["きょう「しつ」","室"],["かい「しゃ」にいく","社"],["「よわ」い","弱"],["「くび」が長い","首"],["しょくよくの「あき」","秋"],["いっ「しゅう」かん","週"],["「はる」がきた","春"],["じを「か」く","書"],["「すくな」い","少"],["「ば」しょをかえよう","場"]],
"2-9":[["クレヨンの「いろ」","色"],["バナナを「た」べる","食"],["「こころ」がいたむ","心"],["「あたら」しいカギ","新"],["さんかんびに「おや」がきた","親"],["「ず」をかく","図"],["「かず」をかぞえる","数"],["「にし」にむかう","西"],["「こえ」がきこえる","声"],["よぞらの「ほし」","星"]],
"2-10":[["てんきが「は」れる","晴"],["さかなを「き」る","切"],["「ゆき」がふる","雪"],["「ふね」にのる","船"],["てんをむすぶと「せん」になる","線"],["「まえ」を見て","前"],["うでを「く」む","組"],["ぜんりょくで「はし」る","走"],["ミスが「おお」い","多"],["えだが「ふと」いきだ","太"]],
"2-11":[["「からだ」がおおきい","体"],["「だい」どころ","台"],["デパートの「ち」か","地"],["「いけ」をおよぐこい","池"],["じじつを「し」る","知"],["お「ちゃ」がうまい","茶"],["「ひる」ごはんがたのしみ","昼"],["「なが」いものにまかれろ","長"],["「とり」がとんでいる","鳥"],["あたらしい「あさ」がきた","朝"]],
"2-12":[["しせいを「なお」す","直"],["あのみちを「とお」る","通"],["かわいい「おとうと」","弟"],["お「みせ」やさん","店"],["「てん」をうつ","点"],["「でん」わをかける","電"],["きれあじがよい「かたな」","刀"],["「ふゆ」はさむい","冬"],["くじが「あ」たる","当"],["「ひがし」にむかう","東"]],
"2-13":[["すぐに「こた」える","答"],["「あたま」がいたい","頭"],["じんるいみな「おな」じ","同"],["たんぼ「みち」","道"],["ほんを「よ」む","読"],["「うち」にひめたおもい","内"],["「みなみ」のほうがく","南"],["さかなより「にく」","肉"],["「うま」にのる","馬"]],
"2-14":[["こめを「う」る","売"],["ネットで「か」う","買"],["「むぎ」ばたけ","麦"],["「はん」ぶんこ","半"],["きみの「ばん」だ","番"],["「ちち」とはは","父"],["「かぜ」がきもちいい","風"],["ふたつに「わ」ける","分"],["こえを「き」く","聞"]],
"2-15":[["ちゃわんにはいった「こめ」","米"],["「ある」く","歩"],["「はは」はつよし","母"],["みなみの「ほう」こう","方"],["「きた」のほうがく","北"],["「まい」にちがっこうへいく","毎"],["あねと「いもうと」","妹"],["いち「まん」えん","万"],["「あか」るい","明"],["いぬが「な」く","鳴"],["ねこの「け」","毛"]],
"2-16":[["「もん」がひらく","門"],["「よる」はこわい","夜"],["「の」はらしんのすけ","野"],["「とも」だち","友"],["「もち」いる","用"],["にち「よう」び","曜"],["せんせいが「く」る","来"],["ふる「さと」","里"],["「り」かがとくいだ","理"],["ともだちと「はな」す","話"]],

/* ========== ここから3年生 ========== */
"3-1":[["わるいこと","悪"],["やすらか","安"],["くらいよる","暗"],["いしゃにみてもらう","医"],["いいんかい","委"],["こころをつかう","意"],["そだてる","育"],["いんのひと","員"],["いんかんをおす","院"],["のむ","飲"]],
"3-2":[["うんどう","運"],["およぐ","泳"],["えき","駅"],["おう","央"],["よこ","横"],["や","屋"],["おんど","温"],["に","化"],["にもつをはこぶ","荷"],["かい","界"]],
"3-3":[["ひらく","開"],["かいだん","階"],["さむい","寒"],["かんじる","感"],["かん","漢"],["かんかん","館"],["きし","岸"],["おきる","起"],["き","期"],["きゃく","客"]],
"3-4":[["きわめる","究"],["きゅう","急"],["きゅう","級"],["みや","宮"],["たま","球"],["さる","去"],["はし","橋"],["ぎょう","業"],["きょく","曲"],["きょく","局"]],
"3-5":[["ぎんこう","銀"],["く","区"],["にがい","苦"],["ぐ","具"],["きみ","君"],["かかり","係"],["かるい","軽"],["ち","血"],["けつ","決"],["とぎ","研"]],
"3-6":[["けん","県"],["くら","庫"],["みずうみ","湖"],["むく","向"],["しあわせ","幸"],["みなと","港"],["ごう","号"],["ね","根"],["まつり","祭"],["さら","皿"],["し","仕"]],
"3-7":[["しぬ","死"],["つかう","使"],["はじめる","始"],["ゆび","指"],["は","歯"],["し","詩"],["つぎ","次"],["こと","事"],["もつ","持"],["しき","式"]],
"3-8":[["じつ","実"],["うつす","写"],["もの","者"],["ぬし","主"],["まもる","守"],["とる","取"],["さけ","酒"],["うける","受"],["しゅう","州"],["ひろう","拾"]],
"3-9":[["おわる","終"],["ならう","習"],["あつまる","集"],["すむ","住"],["おもい","重"],["やど","宿"],["ところ","所"],["あつい","暑"],["たすける","助"],["あきらか","昭"]],
"3-10":[["きえる","消"],["しょう","商"],["しょう","章"],["かつ","勝"],["のる","乗"],["うえる","植"],["もうす","申"],["み","身"],["かみさま","神"],["まこと","真"]],
"3-11":[["ふかい","深"],["すすむ","進"],["よ","世"],["ととのえる","整"],["むかし","昔"],["ぜん","前"],["しん","新"],["しゅう","習"],["せい","精"],["しんぶん","新聞"]],
"3-12":[["せき","席"],["せい","制"],["せい","性"],["せん","線"],["せんぱい","先輩"],["せんたく","選択"],["そう","想"],["そつ","卒"],["そう","総"],["そう","操"]],
"3-13":[["たいせつ","大切"],["だいがく","大学"],["だいすう","代数"],["ちず","地図"],["ちょうかん","長官"],["ちょう","長"],["ちょうり","調理"],["ちょうせい","調整"],["ちょうりつ","条例"]],
"3-14":[["ちょうこく","彫刻"],["ちょうさ","調査"],["ちょうてん","頂点"],["つうやく","通訳"],["つうしん","通信"],["つうろ","通路"],["つうきん","通勤"],["つうろ","通路"],["つう","通"]],
"3-15":[["てん","点"],["てい","定"],["てき","敵"],["てつ","鉄"],["てら","寺"],["てんいん","店員"],["てんかい","展開"],["てんこう","転校"],["てんき","天気"]],
"3-16":[["とう","頭"],["とうきょう","東京"],["とうろ","道路"],["とうひょう","投票"],["とうちゃく","到着"],["とうせん","当選"],["とうだい","灯台"],["とうなん","島南"]],
"3-17":[["ないよう","内容"],["ないか","内科"],["ないぶ","内部"],["ないこう","内航"],["ないし","内視"],["ないせい","内政"],["ないそく","内側"],["ないせつ","内設"],["ないりょく","能力"],["ないよう","内容"]],
"3-18":[["にちじょう","日常"],["にほん","日本"],["にんげん","人間"],["にんずう","人数"],["にんき","人気"],["にんしき","認識"],["にんげん","人間"],["にんい","任意"],["にんか","任課"],["にんこう","任校"]],
"3-19":[["ねこ","猫"],["ねつ","熱"],["ねがい","願"],["ねんど","年度"],["ねむい","眠"],["ねずみ","鼠"],["ねじ","ネジ"],["ねん","年"],["ねがい","願"]],
"3-20":[["のりもの","乗物"],["のうか","農家"],["のうりょく","能力"],["のうさん","農産"],["のうかん","脳幹"],["のうこう","濃厚"],["のうりつ","能率"],["のうりょく","能力"],["のうぎょう","農業"]]
};

let currentGroup = [];
let questionHistory = [];
let savedDrawings = [];
let i = 0, t = 0;
let drawingEnabled = true;
let isDrawing = false;

const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
ctx.lineWidth = 5;
ctx.strokeStyle = '#000';

function getPoint(e) {
    const rect = canvas.getBoundingClientRect();
    let clientX, clientY;
    if (e.touches && e.touches.length > 0) {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
    } else {
        clientX = e.clientX;
        clientY = e.clientY;
    }
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
}
function startDrawing(e){ if(!drawingEnabled)return; e.preventDefault(); isDrawing=true; const {x,y}=getPoint(e); ctx.beginPath(); ctx.moveTo(x,y);}
function draw(e){ if(!isDrawing||!drawingEnabled)return; e.preventDefault(); const {x,y}=getPoint(e); ctx.lineTo(x,y); ctx.stroke();}
function stopDrawing(){ isDrawing=false; ctx.closePath();}
function clearCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height);}
function saveCanvasImage(){
    const tempCanvas = document.createElement('canvas');
    tempCanvas.width = canvas.width;
    tempCanvas.height = canvas.height;
    const tempCtx = tempCanvas.getContext('2d');
    tempCtx.fillStyle = '#fff';
    tempCtx.fillRect(0,0,tempCanvas.width,tempCanvas.height);
    tempCtx.drawImage(canvas,0,0);
    return tempCanvas.toDataURL();
}

canvas.addEventListener('mousedown',startDrawing);
canvas.addEventListener('mousemove',draw);
canvas.addEventListener('mouseup',stopDrawing);
canvas.addEventListener('mouseleave',stopDrawing);
canvas.addEventListener('touchstart',startDrawing);
canvas.addEventListener('touchmove',draw);
canvas.addEventListener('touchend',stopDrawing);

function startGroup(key){
    currentGroup = shuffle([...groups[key]]);
    i=0; t=0;
    questionHistory=[]; savedDrawings=[];
    drawingEnabled=true;
    clearCanvas();
    document.getElementById('groupSelect').style.display='none';
    document.getElementById('resultsScreen').style.display='none';
    document.getElementById('gameScreen').style.display='block';
    document.getElementById('nextButton').textContent="次へ（クリックして開始）";
    document.getElementById('nextButton').onclick = change;
    document.getElementById('clearButton').disabled = true;
    document.getElementById('question').textContent="練習開始！";
}

function change(){
    const Q=document.getElementById('question');
    const clearBtn=document.getElementById('clearButton');

    if(i>=10 && t===0){
        Q.textContent="全問終了！結果を確認してね。";
        document.getElementById('nextButton').textContent="結果を見る";
        document.getElementById('nextButton').onclick=endGame;
        clearBtn.disabled=true;
        return;
    }

    if(t===0){
        if(i>0)savedDrawings.push(saveCanvasImage());
        clearCanvas(); drawingEnabled=true;
        const [q,a]=currentGroup[i];
        Q.textContent=`問${i+1}: ${q}`;
        questionHistory.push({question:q,answer:a});
        document.getElementById('nextButton').textContent="解答へ";
        clearBtn.disabled=false;
        t=1;

        if(Math.random()<0.5){ showRandomCharacter(); }

    } else {
        drawingEnabled=false;
        Q.textContent=`問${i+1}: ${currentGroup[i][1]}`;
        document.getElementById('nextButton').textContent=(i<9)?"次の問題へ":"結果を見る";
        clearBtn.disabled=true;
        t=0; i++;
    }
}

function endGame(){
    savedDrawings.push(saveCanvasImage());
    document.getElementById('gameScreen').style.display='none';
    document.getElementById('resultsScreen').style.display='block';
    const results=document.getElementById('results');
    results.innerHTML='';
    questionHistory.forEach((h,idx)=>{
        const div=document.createElement('div');
        div.className='result-item';
        div.innerHTML=`<p><strong>問${idx+1}:</strong> ${h.question} → <strong>${h.answer}</strong></p>`;
        const img=document.createElement('img');
        img.src=savedDrawings[idx];
        div.appendChild(img);
        results.appendChild(div);
    });
}
document.getElementById('restartButton').onclick=()=>{
    i=0;t=0;questionHistory=[];savedDrawings=[];
    document.getElementById('resultsScreen').style.display='none';
    document.getElementById('groupSelect').style.display='block';
    clearCanvas();
};

document.getElementById('clearButton').onclick=()=>{ if(!drawingEnabled)return; clearCanvas(); };

function shuffle(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]]; } return array; }
const btnArea=document.getElementById('groupButtons');
Object.keys(groups).forEach(k=>{
    const btn=document.createElement('button');
    btn.textContent=k;
    btn.className='group-button group-'+k.charAt(0);
    btn.onclick=()=>startGroup(k);
    btnArea.appendChild(btn);
});

function showRandomCharacter(){
    const chars=["neko1.png","neko2.png","neko3.png","neko4.png"];
    const img = document.createElement('img');
    img.src="img/"+chars[Math.floor(Math.random()*chars.length)];
    img.className="character";
    const layer = document.getElementById('animationLayer');
    layer.appendChild(img);

    let x = Math.random() * (window.innerWidth - 60);
    let y = Math.random() * (window.innerHeight - 60);
    let dx = (Math.random()-0.5)*4;
    let dy = (Math.random()-0.5)*4;
    let rotation = 0;
    let dRotation = (Math.random()-0.5)*0.2;

    function animate(){
        x += dx;
        y += dy;
        rotation += dRotation;
        img.style.transform = `translate(${x}px, ${y}px) rotate(${rotation}rad)`;
        if(x<-100 || x>window.innerWidth+100 || y<-100 || y>window.innerHeight+100){
            img.remove();
            return;
        }
        requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
}
</script>
</body>
</html>
